<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éµã®åˆ©ç”¨çŠ¶æ³</title>
  <style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; color: #333; }
    h2 { text-align: center; margin-bottom: 20px; }
    
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ */
    .status-card { text-align: center; padding: 30px 20px; margin-bottom: 30px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-weight: bold; font-size: 24px; transition: all 0.3s ease; }
    .status-out { background-color: #fff3cd; color: #856404; border: 2px solid #ffeeba; }
    .status-in { background-color: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
    
    /* å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ« */
    .history-section { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    h3 { font-size: 16px; margin-top: 0; color: #666; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 12px 5px; text-align: left; border-bottom: 1px solid #eee; }
    th { color: #888; font-weight: normal; font-size: 12px; }
    
    .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
    .badge-borrow { background: #ffeeba; color: #856404; }
    .badge-return { background: #d4edda; color: #155724; }
    
    #loading { text-align: center; color: #999; margin-top: 20px; }
  </style>
</head>
<body>

  <h2>ğŸ”‘ éµç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h2>

  <div id="current-status" class="status-card" style="display:none;">
    ç¢ºèªä¸­...
  </div>

  <div class="history-section">
    <h3>æœ€è¿‘ã®å±¥æ­´</h3>
    <div id="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
    <table id="log-table" style="display:none;">
      <thead>
        <tr>
          <th>æ—¥æ™‚</th>
          <th>åå‰</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="log-body">
        </tbody>
    </table>
  </div>

  <script>
    // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
    // ã€é‡è¦ã€‘ã“ã“ã«GASã®ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã€ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzS-HvmIaMkzNl65ZbWsm56md-ImZSF0Iu96fsKgB1W-laLoBPbuqk3HyPGgqYB3gej/exec"; 
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    async function fetchLog() {
      try {
        const response = await fetch(GAS_URL);
        const data = await response.json();
        
        // æ–°ã—ã„é †ã«ä¸¦ã³æ›¿ãˆ
        data.reverse();

        // 1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        const statusDiv = document.getElementById('current-status');
        if (data.length > 0) {
          const latest = data[0];
          if (latest.action.includes('å€Ÿã‚Š')) {
            statusDiv.innerHTML = `âš ï¸ ç¾åœ¨ è²¸å‡ºä¸­<br><span style="font-size:16px; font-weight:normal;">(è²¸å‡ºè€…: ${latest.name})</span>`;
            statusDiv.className = "status-card status-out";
          } else {
            statusDiv.innerHTML = `âœ… ç¾åœ¨ è­¦å‚™å“¡å®¤<br><span style="font-size:16px; font-weight:normal;">(æœ€çµ‚è¿”å´: ${latest.name})</span>`;
            statusDiv.className = "status-card status-in";
          }
        } else {
          statusDiv.innerText = "å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“";
          statusDiv.className = "status-card";
        }
        statusDiv.style.display = 'block';

        // 2. å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
        const tbody = document.getElementById('log-body');
        data.forEach(item => {
          const row = document.createElement('tr');
          const isBorrow = item.action.includes('å€Ÿã‚Š');
          const badgeClass = isBorrow ? 'badge-borrow' : 'badge-return';
          
          row.innerHTML = `
            <td>${item.date}</td>
            <td>${item.name}</td>
            <td><span class="badge ${badgeClass}">${item.action}</span></td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById('loading').style.display = 'none';
        document.getElementById('log-table').style.display = 'table';

      } catch (e) {
        document.getElementById('loading').innerText = "èª­ã¿è¾¼ã¿å¤±æ•—: " + e;
      }
    }

    fetchLog();
  </script>
</body>
</html>
